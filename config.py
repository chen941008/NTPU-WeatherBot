# config.py
import os
from dotenv import load_dotenv
from typing import List, Dict

load_dotenv()

# ---- 配置與常數 (Configuration & Constants) ----

# 頻道與 API 金鑰設定
CHANNEL_SECRET = os.getenv("LINE_CHANNEL_SECRET")
CHANNEL_TOKEN = os.getenv("LINE_CHANNEL_ACCESS_TOKEN")
CWA_API_KEY = os.getenv("CWA_API_KEY")
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
GOOGLE_MAPS_API_KEY = os.getenv("GOOGLE_MAPS_API_KEY")
CWA_INSECURE = os.getenv("CWA_INSECURE")

# 資料庫連線設定
DATABASE_URL = os.environ.get('DATABASE_URL')
if DATABASE_URL and DATABASE_URL.startswith("postgres://"):
    DATABASE_URL = DATABASE_URL.replace("postgres://", "postgresql://", 1)

if not DATABASE_URL:
    # 預設使用 SQLite
    DATABASE_URL = "sqlite:///bot.db"

# 食譜資料來源 URL (這是之前漏掉的！)
RECIPES_URL = 'https://mp-bc8d1f0a-3356-4a4e-8592-f73a3371baa2.cdn.bspapp.com/all_recipes.json'

# 模型優先順序清單
MODEL_PRIORITY: List[str] = [
    "gemini-2.5-pro",
    "gemini-2.5-flash",
    "gemini-2.0-flash",
    "gemini-2.0-flash-exp",
    "gemini-2.5-flash-lite",
    "gemini-2.0-flash-lite",
    "gemma-3-27b",
    "gemma-3-12b",
]

# ----------------------------------------------------
# 意圖與標準問句庫 (Knowledge Base)
# ----------------------------------------------------
INTENT_KNOWLEDGE_BASE = {
    # 打招呼
    "greeting": [
        "你好", "哈囉", "嗨", "早安", "午安", "晚安", "Hi", "Hello", 
        "有人在嗎", "安安", "嘿", "Yo", "早", "機器人你好", "測試", 
        "在嗎", "出來面對", "哈囉你好", "晚安囉"
    ],

    # 天氣相關
    "weather": [
        "天氣如何", "查詢天氣", "氣溫幾度", "現在幾度", "台北天氣", "下雨機率",
        "外面有下雨嗎", "要帶傘嗎", "會下雨嗎", "出門要不要帶雨具", "有沒有降雨機率",
        "明天會冷嗎", "熱死人了", "今天好冷喔", "週末天氣好嗎", "適合出遊嗎",
        "天氣", "氣象", "下雨", "溫度"
    ],

    # 穿搭建議
    "clothing_advice": [
        "今天穿什麼", "穿搭建議", "怎麼穿比較好", "給點穿搭意見",
        "外面冷嗎要穿外套嗎", "適合穿短袖嗎", "穿這樣會冷嗎", "需不需要穿大衣",
        "要穿長袖還是短袖", "洋蔥式穿法", "今天適合穿裙子嗎",
        "怕冷怎麼穿", "騎車要穿什麼", "今天風大嗎要穿什麼", "有沒有穿搭靈感"
    ],

    # 食譜查詢 (程式啟動時還會動態注入更多菜名)
    "search_recipe": [
        "教我做菜", "食譜查詢", "作法教學", "怎麼煮", "料理教學", "我想學做菜",
        "怎麼煮紅燒肉", "我想學做義大利麵", "番茄炒蛋作法", "宮保雞丁怎麼弄",
        "教我煮咖哩", "我想吃麻婆豆腐", "牛肉麵食譜", "三杯雞作法", 
        "紅燒魚", "炒高麗菜", "玉米濃湯", "食譜"
    ],

    # 冰箱剩菜/食材推薦
    "suggest_by_ingredients": [
        "冰箱只剩雞蛋", "清冰箱料理", "冰箱有番茄可以做什麼", "家裡只有麵條",
        "剩菜怎麼煮", "幫我消耗食材", "只有豆腐怎麼辦", "冰箱剩這些",
        "食材推薦", "我有洋蔥和蛋", "用雞胸肉做一道菜", "這些材料能煮什麼",
        "推薦一道用馬鈴薯的菜", "幫我想料理"
    ],

    # 隨機食譜
    "random_recipe": [
        "晚餐吃什麼", "午餐吃什麼", "早餐吃什麼", "幫我決定晚餐", "不知道吃什麼",
        "隨便推薦一道菜", "我想不到要吃啥", "有什麼好吃的", "推薦晚餐",
        "肚子好餓", "快餓扁了", "餓了", "想吃好料的", "隨便來一道", 
        "今晚吃什麼", "介紹一道菜"
    ],

    # 食材替代
    "substitute_ingredient": [
        "沒有醬油怎麼辦", "奶油可以用什麼代替", "缺少調味料", "家裡沒糖了",
        "沒有米酒", "可以用牛奶代替鮮奶油嗎", "沒有太白粉",
        "替代食材", "這可以用什麼換", "有什麼替代品", "如果不加這個會怎樣",
        "沒買到洋蔥"
    ],

    # 運勢
    "fortune": [
        "今日運勢", "運氣如何", "抽籤", "占卜", "好運嗎", "星座運勢",
        "我今天運氣好嗎", "水逆了嗎", "幫我算命", "今日宜忌", "我的運勢",
        "處女座運勢", "今天會幸運嗎"
    ],

    # 附近景點
    "search_nearby": [
        "附近有什麼好玩的", "推薦景點", "這附近哪裡好玩", "旅遊推薦", "導覽",
        "好無聊喔", "我想出去玩", "假日去哪裡", "帶我去玩", "附近有什麼地標",
        "哪裡適合約會", "附近景點", "好玩的", "我要去玩"
    ]
}

# 城市名稱對照表
CITY_ALIASES: Dict[str, str] = {
    "台北": "臺北市", "臺北": "臺北市", "北市": "臺北市", "臺北市": "臺北市", "台北市": "臺北市",
    "新北": "新北市", "新北市": "新北市", "台中": "臺中市", "臺中": "臺中市", "臺中市": "臺中市", "台中市": "臺中市",
    "台南": "臺南市", "臺南": "臺南市", "臺南市": "臺南市", "台南市": "臺南市", "高雄": "高雄市", "高雄市": "高雄市",
    "桃園": "桃園市", "桃園市": "桃園市", "新竹": "新竹市", "新竹市": "新竹市", "基隆": "基隆市", "基隆市": "基隆市",
    "嘉義": "嘉義市", "嘉義市": "嘉義市", "宜蘭": "宜蘭縣", "宜蘭縣": "宜蘭縣", "花蓮": "花蓮縣", "花蓮縣": "花蓮縣",
    "台東": "臺東縣", "臺東": "臺東縣", "臺東縣": "臺東縣", "台東縣": "臺東縣", "屏東": "屏東縣", "屏東縣": "屏東縣",
    "苗栗": "苗栗縣", "苗栗縣": "苗栗縣", "彰化": "彰化縣", "彰化縣": "彰化縣", "雲林": "雲林縣", "雲林縣": "雲林縣",
    "南投": "南投縣", "南投縣": "南投縣", "嘉義縣": "嘉義縣", "新竹縣": "新竹縣",
    "連江": "連江縣", "連江縣": "連江縣", "金門": "金門縣", "金門縣": "金門縣", "澎湖": "澎湖縣", "澎湖縣": "澎湖縣",
}